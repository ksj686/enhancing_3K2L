<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script> 
</head>
<body>
	<ul th:object=${board}>
		<li th:text="|ì‘ì„±ì: *{memberId}|"></li>
		<li th:text="|(ê°ì •: *{boardCategory})|"></li>
		<li th:text="|ë‚ ì§œ: *{boardDate}|"></li>
		<li th:text="|ì œëª©: *{boardTitle}|"></li>
		<li th:utext="|ë‚´ìš©: *{boardContent}|"></li>
	</ul>
	<th:block>
		<th:block th:if="${board.memberId} != ${session.memberid}">
			<button id="report-btn">ğŸš¨</button>
		</th:block>
		<th:block th:if="${board.memberId} == ${session.memberid}">
			<p th:text="|ğŸš¨ì‹ ê³  ëˆ„ì ìˆ˜: ${board.boardReport}|"></p>
		</th:block>
	</th:block>

	<script>
		const boardId = [[${board.boardId}]];
		const boardCategory = `[[${board.boardCategory}]]`;

		$('#report-btn').on('click', function() {
			$.ajax({
				url: '/emo/report',
				method: 'PUT',
				data: { boardId: boardId },
				success: function(response) {
					if (response.status === "OK") {
						console.log("ì‹ ê³  ì„±ê³µ");
						window.confirm("ì‹ ê³  ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.")
						const reportCount = response.reportCount;
						console.log(reportCount);
						if (reportCount >= 5) {
							window.confirm("ê²Œì‹œê¸€ì´ ìˆ¨ê¹€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.")
							window.location.href = `/emo/${boardCategory}`;
						}
					} else {
						console.error("ì‹ ê³  ì‹¤íŒ¨:", response);
					}

				},
				error: function(xhr, status, error) {
					console.error("ì‹ ê³  ì‹¤íŒ¨:", error);
				}
			});
		});
	</script>
</body>
</html>