<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script> 
</head>
<body>
	<ul th:object=${board}>
		<li th:text="|ì‘ì„±ì: *{memberId}|"></li>
		<li th:text="|(ê°ì •: *{boardCategory})|"></li>
		<li th:text="|ë‚ ì§œ: *{boardDate}|"></li>
		<li th:text="|ì œëª©: *{boardTitle}|"></li>
		<li th:utext="|ë‚´ìš©: *{boardContent}|"></li>
	</ul>
	<th:block>
		<th:block th:if="${board.memberId} != ${session.memberid}">
			<button id="report-btn" style="font-size: 30px">ğŸš¨</button>
		</th:block>
		<th:block th:if="${board.memberId} == ${session.memberid}">
			<p th:text="|ğŸš¨ì‹ ê³  ëˆ„ì ìˆ˜: ${board.boardReport}|" style="font-size: 20px"></p>
		</th:block>
	</th:block>
	<div style="font-size: 40px; display: flex;" th:object="${emoji}">
		<div id="joy-btn" style="cursor: pointer;">
			<p>â˜ºï¸</p>
			<p id="joy-cnt" th:text="*{joy}" style="font-size: 20px;"></p>
		</div>
		<div id="cheer-btn" style="cursor: pointer;">
			<p>ğŸ˜†</p>
			<p id="cheer-cnt" th:text="*{cheer}" style="font-size: 20px;"></p>
		</div>
		<div id="worry-btn" style="cursor: pointer;">
			<p>ğŸ¥º</p>
			<p id="worry-cnt" th:text="*{worry}" style="font-size: 20px;"></p>
		</div>
		<div id="sad-btn" style="cursor: pointer;">
			<p>ğŸ˜­</p>
			<p id="sad-cnt" th:text="*{sad}" style="font-size: 20px;"></p>
		</div>
	</div>

	<button id="boardList">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>

	<script>
		const boardId = [[${board.boardId}]];
		const boardCategory = `[[${board.boardCategory}]]`;
		const sessionId = `[[${session.memberid}]]`;
		const memberId = `[[${board.memberId}]]`;

		$('#report-btn').on('click', function() {
			if (!sessionId) {
				window.location.href = '/login';
				return;
			}
			
			$.ajax({
				url: '/emotion/report',
				method: 'PUT',
				data: { boardId: boardId },
				success: function(response) {
					if (response.status === "OK") {
						// console.log("ì‹ ê³  ì„±ê³µ");
						window.confirm("ì‹ ê³  ì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.")
						const boardReport = response.boardReport;
						// console.log(boardReport);
						if (boardReport >= 5) {
							window.confirm("ê²Œì‹œê¸€ì´ ìˆ¨ê¹€ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.")
							window.location.href = `/emotion/${boardCategory}`;
						}
					} else {
						// console.error("ì‹ ê³  ì‹¤íŒ¨:", response);
					}
				},
				error: function(xhr, status, error) {
					// console.error("ì‹ ê³  ì‹¤íŒ¨:", error);
				}
			});
		});

		const emojis = ['joy', 'cheer', 'worry', 'sad'];
		
		emojis.forEach(emoji => {
			$(`#${emoji}-btn`).on('click', function() {
				if (!sessionId) {
					window.location.href = '/login';
					return;
				} else if (sessionId == memberId) {
					window.confirm("ë³¸ì¸ì˜ ê²Œì‹œê¸€ì—ëŠ” ê³µê°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
					return
				}

				$.ajax({
					url: '/emoji',
					method: 'PUT',
					data: {
						boardId: boardId,
						emojiCategory: emoji
					},
					success: function(response) {
						if (response.status === "OK") {
							// console.log(`${emoji} ë°˜ì‘ ì„±ê³µ`);
							$.ajax({
								url: `/emoji/${boardId}/${emoji}`,
								method: 'GET',
							success: function(response) {
								if (response.status === "OK") {
									// console.log(`${emoji} 1 ì¦ê°€`);
									$(`#${emoji}-cnt`).text(response.emojiCnt);
								} else {
									// console.log(`${emoji} ì¦ê°€ ì‹¤íŒ¨:`, response);
								}
							},
							error: function(xhr, status, error) {
								// console.log(`${emoji} ì¦ê°€ ì‹¤íŒ¨:`, error);
							}
						});
						} else {
							// console.error(`${emoji} ë°˜ì‘ ì‹¤íŒ¨:`, response);
						}
					},
					error: function(xhr, status, error) {
						// console.error(`${emoji} ë°˜ì‘ ì‹¤íŒ¨:`, error);
					}
				});
			});
		});

		$('#boardList').on('click', function() {
			window.location.href = `/emotion/${boardCategory}`;
		})
	</script>
</body>
</html>