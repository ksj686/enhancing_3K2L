<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
	<!-- TUI ì—ë””í„° CSS CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.min.css"/>
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
	<style>
        * {
            text-align: center;
        }
        #editor {
            width: 50%;
            margin: 0 auto;
        }
    </style>

    <title>JOURNIVERSE | DIARY FORM</title>
</head>

<body>
    <div class="content-wrapper">
        <div class="main-content-wrapper">
        	<!-- ì¼ê¸° ë¦¬ìŠ¤íŠ¸ ë§í¬ -->
        	<div class="top-navigation">
        		<a th:href="@{/diary/list}" class="back-to-list">â† ë¦¬ìŠ¤íŠ¸ë¡œ ëŒì•„ê°€ê¸°</a>
        	</div>
        	
            <form id="diaryform" th:action="${update != null ? '/diary/update' : '/diary/insert'}" 
            	  method="post" th:object="${diary}" enctype="multipart/form-data">
                
                <input type="hidden" th:field="*{diaryId}">
                
                <div class="form-title">
                    <!-- ì œëª© ì…ë ¥ -->
                    <label for="title">ì œëª© ì‘ì„±</label>
                    <input type="text" th:field="*{diaryTitle}" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”." required>
                </div>
				
				<!-- ë‚ ì§œ ì…ë ¥ -->
				<div class="form-date">
    				<label for="diaryDate">ë‚ ì§œ ì„ íƒ</label>
    				<input type="date" th:field="*{diaryDate}" required>
                </div>
				
				<!-- ì²¨ë¶€ íŒŒì¼ -->
				<div class="file-upload">
					<label for="file">íŒŒì¼ ì²¨ë¶€</label>
					<div class="file-input-wrapper">
						<input type="text" id="fileName" placeholder="íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”." readonly>
						<label for="file" class="file-button">íŒŒì¼ ì„ íƒ</label>
						<input type="file" th:object="${attach}" id="file" name="file" onchange="updateFileName()">		
					</div>
				</div>
				
				<!-- ë‚´ìš© ì…ë ¥ -->
             	<input type="hidden" id="content" th:field="*{diaryContent}" /> <!-- ì—ë””í„° ë‚´ìš©ì´ ì €ì¥ë  ìˆ¨ê²¨ì§„ í•„ë“œ -->
        		<div id="editor" th:data-content="${diary.diaryContent}"></div> <!-- ì—ë””í„° ì˜ì—­ -->

                <!-- ì‘ì„± ì™„ë£Œ ë²„íŠ¼ -->
                <button class="submit-btn" type="submit" th:text="${update != null ? 'ìˆ˜ì •' : 'ì €ì¥'}"></button>
                <button class="cancel-btn" type="button" onclick="resetForm()">ì·¨ì†Œ</button>
            </form>
        </div>
    </div>

	
	<!-- TUI ì—ë””í„° JS CDN / ê¸€ì”¨ êµµê¸°, í¬ê¸° ë“± ë³€ê²½í•˜ëŠ” í¬ë§· ì¶”ê°€í•˜ê¸°.(board new ì—ì„œ ì°¸ê³ ) -->
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <script>
        function updateFileName(){
        	const fileInput = document.getElementById('file');
        	const fileNameInput = document.getElementById('fileName');
        	
        	if (fileInput.files.length > 0) {
        		fileNameInput.value = fileInput.files[0].name;
        	}
        }
    
    	const editor = new toastui.Editor({
            el: document.querySelector('#editor'),
            height: '500px',
            initialEditType: 'wysiwyg',
            initialValue: document.querySelector('#editor').getAttribute('data-content') || '',
            previewStyle: 'vertical'
        });
        
        function resetForm() {
            if (confirm("ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì •ë§ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            	document.getElementById("diaryform").reset();
            	editor.setHTML(''); // ì—ë””í„° ë‚´ìš© ì´ˆê¸°í™”
            	document.getElementById('fileName').value = ''; // ğŸŒŸ íŒŒì¼ëª… í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('file').value = ''; // ğŸŒŸ íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
            }               
        }
   		
 		const onSubmit = (event) => {
 			event.preventDefault();
 			
 			let content = editor.getHTML(); // ì—ë””í„°ì˜ HTML ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
            document.getElementById('content').value = content; // ìˆ¨ê²¨ì§„ í•„ë“œì— ë‚´ìš© ì €ì¥
            // í¼ ì œì¶œ
            document.getElementById('diaryform').submit(); // í¼ ì œì¶œ
        };
     	// ì œì¶œ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.querySelector('.submit-btn').addEventListener('click', onSubmit);
     	

    </script>
</body>
</html>
