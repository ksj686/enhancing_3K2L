<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/thymeleaf/default_layout}">
<head>
	<!-- TUI ì—ë””í„° CSS CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.48.4/codemirror.min.css"/>
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
    <link rel="stylesheet" href="/css/diary/diaryform.css">

    <title>JOURNIVERSE | JOURNAL FORM</title>
</head>

<body>
<div class="main-content" layout:fragment="content">

    <div class="content-wrapper">
    	<!-- title -->
		<div class="title-section">
			<img src="/img/journal/diary-tojournal.png" class="diary-journal" />
		</div>
		
        <div class="main-content-wrapper">
        	<!-- ì¼ê¸° ë¦¬ìŠ¤íŠ¸ ë§í¬ -->
        	<div class="list-btn-container">
        		<a th:href="@{/diary}" class="list-btn">â† ì¼ê¸°ì˜ ë°©ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        	</div>
        	
            <form id="diaryform" th:action="${update != null ? '/diary/update' : '/diary/insert'}" 
            	  method="post" th:object="${diary}" enctype="multipart/form-data">
                
                <input type="hidden" th:field="*{diaryId}">
                
                <div class="diary-title">
                    <!-- ì œëª© ì…ë ¥ -->
                    <input type="text" th:field="*{diaryTitle}" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”." required>
                </div>
				
				<!-- ë‚ ì§œ ì…ë ¥ -->
				<div class="diary-date">
					<label>DATE</label>
    				<input type="date" th:field="*{diaryDate}" required>
                </div>
				
				<!-- ë‚´ìš© ì…ë ¥ -->
             	<input type="hidden" id="content" th:field="*{diaryContent}" /> <!-- ì—ë””í„° ë‚´ìš©ì´ ì €ì¥ë  ìˆ¨ê²¨ì§„ í•„ë“œ -->
        		<div id="editor" class="diary-text" th:data-content="${diary.diaryContent}"></div> <!-- ì—ë””í„° ì˜ì—­ -->

		        <!-- ì²¨ë¶€ íŒŒì¼ -->
				<div class="file-upload">
					<!-- <label for="file">íŒŒì¼ ì„ íƒ</label> -->
					<div class="file-input-wrapper">
						<input type="text" id="fileName" placeholder="íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”." readonly>
						<label for="file" class="file-button">íŒŒì¼ ì„ íƒ</label>
						<input type="file" th:object="${attach}" id="file" name="file" onchange="updateFileName()">		
					</div>
				</div>
            </form>
            <!-- ì‘ì„± ì™„ë£Œ ë²„íŠ¼ -->
        	<div class="button-group">
            	<button class="submit-btn" type="submit" th:text="${update != null ? 'ìˆ˜ì •' : 'ì €ì¥'}"></button>
            	<button class="cancel-btn" type="button" onclick="resetForm()">ì·¨ì†Œ</button>
        	</div>
        </div>

				
        
    </div>

	
	<!-- TUI ì—ë””í„° JS CDN / ê¸€ì”¨ êµµê¸°, í¬ê¸° ë“± ë³€ê²½í•˜ëŠ” í¬ë§· ì¶”ê°€í•˜ê¸°.(board new ì—ì„œ ì°¸ê³ ) -->
    <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
    <script>
        function updateFileName(){
        	const fileInput = document.getElementById('file');
        	const fileNameInput = document.getElementById('fileName');
        	
        	if (fileInput.files.length > 0) {
        		fileNameInput.value = fileInput.files[0].name;
        	}
        }
    
    	const editor = new toastui.Editor({
            el: document.querySelector('#editor'),
            height: '350px',
            initialEditType: 'wysiwyg',
            initialValue: document.querySelector('#editor').getAttribute('data-content') || '',
            previewStyle: 'vertical'
        });
        
        function resetForm() {
            if (confirm("ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ì •ë§ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            	document.getElementById("diaryform").reset();
            	editor.setHTML(''); // ì—ë””í„° ë‚´ìš© ì´ˆê¸°í™”
            	document.getElementById('fileName').value = ''; // ğŸŒŸ íŒŒì¼ëª… í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('file').value = ''; // ğŸŒŸ íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
                
                // ğŸŒŸ ë‹¤ì´ì–´ë¦¬ í™ˆ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = "/diary/";
            }               
        }
   		
 		const onSubmit = (event) => {
 			event.preventDefault();
 			
 			let content = editor.getHTML(); // ì—ë””í„°ì˜ HTML ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
            document.getElementById('content').value = content; // ìˆ¨ê²¨ì§„ í•„ë“œì— ë‚´ìš© ì €ì¥
            // í¼ ì œì¶œ
            document.getElementById('diaryform').submit(); // í¼ ì œì¶œ
        };
     	// ì œì¶œ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.querySelector('.submit-btn').addEventListener('click', onSubmit);
     	

    </script>
</div>
</body>
</html>
